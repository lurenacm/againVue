{"version":3,"file":"vue.js","sources":["../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 使用 Object.definedProperty 重新给data 属性添加 get/set 实现响应式的变化\r\n\r\n/** Observer 就是来添加 get/set 的 class */\r\nclass Observer {\r\n    constructor(value) {\r\n         // vue 不监控数组的每一项，因为性能消耗很大\r\n         // 通过操作数组的索引转变成操作数组的方法。\r\n        if(Array.isArray(value)){   \r\n                \r\n        }else{\r\n            this.walk(value)    // 对对象的属性进行添加get/set\r\n        }\r\n    }\r\n\r\n    // 检测每一步的数据变化\r\n    walk(data) {\r\n        let keys = Object.keys(data)    //keys = [name, age, attr]\r\n        keys.forEach(key => {\r\n            definedReactive(data, key, data[key])\r\n        })\r\n    }\r\n}\r\n\r\nfunction definedReactive(data, key, value) {\r\n    // 递归实现 对象的数据添加`get/set`\r\n    observer(value)\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if(newValue === value )  return\r\n            // 这里再次使用递归考虑到属性的赋值可能是一个对象。\r\n            observer(newValue)\r\n            value =  newValue\r\n        }\r\n    })\r\n}\r\n\r\nexport function observer(data) {\r\n    if(typeof data === 'object' && data !== null) {\r\n        return new Observer(data)\r\n    }\r\n}","// 初始化 props data computed watch 等属性\r\nimport {observer} from './observer/index'\r\n\r\nexport function initState(vm) {\r\n    let opts = vm.$options\r\n    if (opts.props) {\r\n        initPros(vm)\r\n    }\r\n    if (opts.methods) {\r\n        initMethods(vm)\r\n    }\r\n    if (opts.data) {\r\n        initData(vm)\r\n    }\r\n    if (opts.computed) {\r\n        initComputed(vm)\r\n    }\r\n    if (opts.watch) {\r\n        initWatch(vm)\r\n    }\r\n}\r\n\r\nfunction initPros(){}\r\nfunction initMethods(){}\r\n\r\n/** vm._data 是为了保证可以访问到data(data假如是函数)属性的值 */\r\nfunction initData(vm){\r\n    let data = vm.$options.data\r\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data\r\n    // console.log('opts', data)\r\n\r\n    //响应式原理 数据劫持：劫持data对象的数据，使用 Object.definedProperty() 添加 get/set 方法\r\n    observer(data)\r\n}\r\n\r\nfunction initComputed(){}\r\nfunction initWatch(){}","import {initState} from './state'\r\n\r\nexport function initMixin(myVue) {\r\n    // 初始化流程\r\n    myVue.prototype._init = function (options) {\r\n        // 数据劫持，其他地方也需要使用\r\n        const vm = this\r\n        this.$options = options\r\n\r\n        // 初始化数据\r\n        initState(vm)\r\n    }\r\n\r\n\r\n}","import {initMixin} from './init'\r\nfunction myVue(options = {}){\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(myVue)\r\nexport default myVue"],"names":["Observer","value","Array","isArray","walk","data","keys","Object","forEach","key","definedReactive","observer","defineProperty","get","set","newValue","initState","vm","opts","$options","props","methods","initData","computed","watch","_data","call","initMixin","myVue","prototype","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;;EAEA;MACMA;EACF,oBAAYC,KAAZ,EAAmB;EAAA;;EACd;EACA;EACD,QAAGC,KAAK,CAACC,OAAN,CAAcF,KAAd,CAAH,EAAwB,CAAxB,MAEK;EACD,WAAKG,IAAL,CAAUH,KAAV,EADC;EAEJ;EACJ;;;;;aAGD,cAAKI,IAAL,EAAW;EACP,UAAIC,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYD,IAAZ,CAAX,CADO;;EAEPC,MAAAA,IAAI,CAACE,OAAL,CAAa,UAAAC,GAAG,EAAI;EAChBC,QAAAA,eAAe,CAACL,IAAD,EAAOI,GAAP,EAAYJ,IAAI,CAACI,GAAD,CAAhB,CAAf;EACH,OAFD;EAGH;;;;;;EAGL,SAASC,eAAT,CAAyBL,IAAzB,EAA+BI,GAA/B,EAAoCR,KAApC,EAA2C;EACvC;EACAU,EAAAA,QAAQ,CAACV,KAAD,CAAR;EACAM,EAAAA,MAAM,CAACK,cAAP,CAAsBP,IAAtB,EAA4BI,GAA5B,EAAiC;EAC7BI,IAAAA,GAD6B,iBACvB;EACF,aAAOZ,KAAP;EACH,KAH4B;EAI7Ba,IAAAA,GAJ6B,eAIzBC,QAJyB,EAIf;EACV,UAAGA,QAAQ,KAAKd,KAAhB,EAAyB,OADf;;EAGVU,MAAAA,QAAQ,CAACI,QAAD,CAAR;EACAd,MAAAA,KAAK,GAAIc,QAAT;EACH;EAT4B,GAAjC;EAWH;;EAEM,SAASJ,QAAT,CAAkBN,IAAlB,EAAwB;EAC3B,MAAG,QAAOA,IAAP,MAAgB,QAAhB,IAA4BA,IAAI,KAAK,IAAxC,EAA8C;EAC1C,WAAO,IAAIL,QAAJ,CAAaK,IAAb,CAAP;EACH;EACJ;;EC3CD;EAGO,SAASW,SAAT,CAAmBC,EAAnB,EAAuB;EAC1B,MAAIC,IAAI,GAAGD,EAAE,CAACE,QAAd;;EACA,MAAID,IAAI,CAACE,KAAT,EAAgB;;EAGhB,MAAIF,IAAI,CAACG,OAAT,EAAkB;;EAGlB,MAAIH,IAAI,CAACb,IAAT,EAAe;EACXiB,IAAAA,QAAQ,CAACL,EAAD,CAAR;EACH;;EACD,MAAIC,IAAI,CAACK,QAAT,EAAmB;;EAGnB,MAAIL,IAAI,CAACM,KAAT,EAAgB;EAGnB;EAKD;;;EACA,SAASF,QAAT,CAAkBL,EAAlB,EAAqB;EACjB,MAAIZ,IAAI,GAAGY,EAAE,CAACE,QAAH,CAAYd,IAAvB;EACAA,EAAAA,IAAI,GAAGY,EAAE,CAACQ,KAAH,GAAW,OAAOpB,IAAP,KAAgB,UAAhB,GAA6BA,IAAI,CAACqB,IAAL,CAAUT,EAAV,CAA7B,GAA6CZ,IAA/D,CAFiB;EAKjB;;EACAM,EAAAA,QAAQ,CAACN,IAAD,CAAR;EACH;;EC/BM,SAASsB,SAAT,CAAmBC,KAAnB,EAA0B;EAC7B;EACAA,EAAAA,KAAK,CAACC,SAAN,CAAgBC,KAAhB,GAAwB,UAAUC,OAAV,EAAmB;EACvC;EACA,QAAMd,EAAE,GAAG,IAAX;EACA,SAAKE,QAAL,GAAgBY,OAAhB,CAHuC;;EAMvCf,IAAAA,SAAS,CAACC,EAAD,CAAT;EACH,GAPD;EAUH;;ECbD,SAASW,KAAT,GAA4B;EAAA,MAAbG,OAAa,uEAAH,EAAG;;EACxB,OAAKD,KAAL,CAAWC,OAAX;EACH;;EAEDJ,SAAS,CAACC,KAAD,CAAT;;;;;;;;"}