{"version":3,"file":"vue.js","sources":["../../src/observer/arrayMethods.js","../../src/observer/index.js","../../src/state.js","../../src/compile/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 重写数组的 push pop shift unshift reverse sort splice 因为这几个常用方法可以改变原数组\r\n\r\nimport {\r\n    observerArray\r\n} from \"./index\"\r\n\r\n/**继承数组的原型，没有重写的方法使用原型链上的原方法 */\r\nconst oldArrayMethods = Array.prototype\r\nlet arrayMethods = Object.create(oldArrayMethods)\r\n\r\nconst methods = [\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'unshift',\r\n    'reverse',\r\n    'sort',\r\n    'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n    arrayMethods[method] = function (...args) {\r\n        // this 指向的是 (vm.arrs.push ) arrs 这个数组，\r\n        // 需要添加 this 指向调用的对象不然，原型上的 push 没有调用的主体\r\n        let res = oldArrayMethods[method].call(this, ...args)\r\n\r\n        // 为了监控数组添加的数据类型也是一个 object push({}, {}) \r\n        // 需要再次进行数组劫持添加 definedPrototype\r\n        let instead;\r\n        let ob = this.__ob__\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                instead = args\r\n                break;\r\n            case 'splice':\r\n                instead = args;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if (instead) ob.observerArray(instead)\r\n        return res\r\n    }\r\n})\r\n\r\nfunction push() {\r\n    push()\r\n}\r\n\r\nexport {\r\n    arrayMethods\r\n}","// 使用 Object.definedProperty 重新给data 属性添加 get/set 实现响应式的变化\r\n\r\nimport {\r\n    arrayMethods\r\n} from './arrayMethods';\r\n\r\n/** Observer 就是来添加 get/set 的 class */\r\nclass Observer {\r\n    constructor(value) {\r\n        // vue 不监控数组的每一项，因为性能消耗很大\r\n        // 通过操作数组的索引转变成操作数组的方法。\r\n        Object.defineProperty(value, '__ob__', {\r\n            enumerable: false,\r\n            configurable: false,\r\n            value: this\r\n        })\r\n\r\n        if (Array.isArray(value)) {\r\n            value.__proto__ = arrayMethods \r\n            this.observerArray(value)\r\n        } else {\r\n            this.walk(value) // 对对象的属性进行添加get/set\r\n        }\r\n    }\r\n\r\n    // 数组劫持\r\n    observerArray(arr) { // arr: [{},{}]\r\n    // 监控数组中的对象和数组类型，再次递归，性能消耗大\r\n        arr.forEach(item => {\r\n            observer(item)\r\n        }) \r\n        \r\n    }\r\n\r\n    // 对象劫持\r\n    walk(data) {\r\n        let keys = Object.keys(data) //keys = [name, age, attr]\r\n        keys.forEach(key => {\r\n            definedReactive(data, key, data[key])\r\n        })\r\n    }\r\n}\r\n\r\nfunction definedReactive(data, key, value) {\r\n    observer(value)\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if (newValue === value) return\r\n            // 这里再次使用递归考虑到属性的赋值可能是一个对象。\r\n            observer(newValue)\r\n            value = newValue\r\n        }\r\n    })\r\n}\r\n\r\n/** 递归实现 给对象的属性添加`get/set` */\r\nexport function observer(data) {\r\n    if (typeof data === 'object' && data !== null) {\r\n        return new Observer(data)\r\n    }\r\n}","// 初始化 props data computed watch 等属性\r\nimport {\r\n    observer\r\n} from './observer/index'\r\n\r\nexport function initState(vm) {\r\n    let opts = vm.$options\r\n    if (opts.props) {\r\n        initPros(vm)\r\n    }\r\n    if (opts.methods) {\r\n        initMethods(vm)\r\n    }\r\n    if (opts.data) {\r\n        initData(vm)\r\n    }\r\n    if (opts.computed) {\r\n        initComputed(vm)\r\n    }\r\n    if (opts.watch) {\r\n        initWatch(vm)\r\n    }\r\n}\r\n\r\nfunction initPros() {}\r\n\r\nfunction initMethods() {}\r\n\r\n/** vm._data 是为了保证可以访问到data(data假如是函数)属性的值 */\r\nfunction initData(vm) {\r\n    let data = vm.$options.data\r\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data\r\n    //响应式原理 数据劫持：劫持data对象的数据，使用 Object.definedProperty() 添加 get/set 方法\r\n\r\n    // 改变访问的方式 vm._data. === vm.  做一层代理\r\n    for (const key in data) {\r\n        proxy(vm, key)\r\n    }\r\n\r\n    observer(data)\r\n}\r\n\r\nfunction proxy(vm, key) {\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return vm['_data'][key]\r\n        },\r\n        set(newVal) {\r\n            return vm['_data'][key] = newVal\r\n        }\r\n    })\r\n}\r\n\r\n\r\nfunction initComputed() {}\r\n\r\nfunction initWatch() {}","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 \r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g // 匹配 {{}} \r\n\r\n// example：<div id+\"#app\">{{msg}}</div>\r\n// 模板编译就是处理 {{msg}} 实现的内容。\r\n\r\nfunction parserHtml(html) {\r\n    \r\n    function advance(len) {\r\n        html = html.substring(len)\r\n        console.log(html)\r\n    }\r\n    \r\n    function parserStartTag(html) {\r\n        let start = html.match(startTagOpen)\r\n        console.log(start)\r\n        if(start) {\r\n            const match = {\r\n                tagName: start[1],  // 标签名\r\n                attrs: []\r\n            }\r\n            advance(start[0].length)\r\n            \r\n        }\r\n        return false\r\n    }\r\n\r\n    // 看解析的内容是否存在，存在就不停的解析\r\n    while (html) {\r\n        let textEnd = html.indexOf('<') // 匹配结束标签的开头\r\n        if (textEnd == 0) {\r\n            /** 解析开始的标签 */\r\n            const startTagMatch = parserStartTag(html)\r\n            break\r\n            // if (startTagMatch) {\r\n\r\n            // }\r\n\r\n            // const endTagMatch = parserEndTag()\r\n            // if (endTagMatch) {\r\n\r\n            // }\r\n        }\r\n    }\r\n\r\n\r\n    function start(tagName, attribute) { // 匹配开始的标签 <div a= ''></div>\r\n\r\n    }\r\n\r\n    function end(tagName) {\r\n\r\n    }\r\n\r\n    // 标签内的文本\r\n    function chart(text) {\r\n\r\n    }\r\n}\r\n\r\nexport function compileToFunction(template) {\r\n    parserHtml(template)\r\n}","import { initState } from './state'\r\nimport {compileToFunction} from './compile/index'\r\n\r\nexport function initMixin(myVue) {\r\n    // 初始化流程\r\n    myVue.prototype._init = function (options) {\r\n        // 数据劫持，其他地方也需要使用\r\n        const vm = this\r\n        this.$options = options\r\n\r\n        // 初始化数据\r\n        initState(vm)\r\n\r\n        // 挂载模板\r\n        if (this.$options.el) {\r\n            vm.$mount(this.$options.el)\r\n        }\r\n    }\r\n\r\n    myVue.prototype.$mount = function (el) {\r\n        let vm = this\r\n        let options = vm.$options\r\n        el = document.querySelector(el)\r\n        if (!vm.render) {\r\n            if (!vm.template && el) {\r\n                let template = el.outerHTML\r\n                // console.log(template)\r\n                // 将模板 template 编译成虚拟 dom \r\n                let render = compileToFunction(template)\r\n                options.render = render\r\n            }\r\n        }\r\n    }\r\n\r\n}","import {initMixin} from './init'\r\nfunction myVue(options = {}){\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(myVue)\r\nexport default myVue"],"names":["oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","res","call","instead","ob","__ob__","observerArray","Observer","value","defineProperty","enumerable","configurable","isArray","__proto__","walk","arr","item","observer","data","keys","key","definedReactive","get","set","newValue","initState","vm","opts","$options","props","initData","computed","watch","_data","proxy","newVal","ncname","qnameCapture","startTagOpen","RegExp","parserHtml","html","advance","len","substring","console","log","parserStartTag","start","match","tagName","attrs","length","textEnd","indexOf","compileToFunction","template","initMixin","myVue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}