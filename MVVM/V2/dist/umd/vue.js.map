{"version":3,"file":"vue.js","sources":["../../src/observer/arrayMethods.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 重写数组的 push pop shift unshift reverse sort splice 因为这几个常用方法可以改变原数组\r\n\r\nimport { observerArray } from \"./index\"\r\n\r\n/**继承数组的原型，没有重写的方法通过使用原型链上的原方法 */\r\nconst oldArrayMethods = Array.prototype\r\nlet arrayMethods = Object.create(oldArrayMethods)\r\n\r\nconst methods = [\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'unshift',\r\n    'reverse',\r\n    'sort',\r\n    'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n    arrayMethods[method] = function (...args) {\r\n        let res = oldArrayMethods[method].apply(this, args)\r\n        let instead;\r\n        let ob = this.__ob__\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                instead = args\r\n                break;\r\n            case 'splice':\r\n                instead = args;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if(instead) ob.observerArray(instead)\r\n        return res\r\n    }\r\n})\r\n\r\n\r\nexport {arrayMethods}    ","// 使用 Object.definedProperty 重新给data 属性添加 get/set 实现响应式的变化\r\n\r\nimport {\r\n    arrayMethods\r\n} from './arrayMethods';\r\n\r\n/** Observer 就是来添加 get/set 的 class */\r\nclass Observer {\r\n    constructor(value) {\r\n        // vue 不监控数组的每一项，因为性能消耗很大\r\n        // 通过操作数组的索引转变成操作数组的方法。\r\n        Object.defineProperty(value, '__ob__', {\r\n            enumerable: false,\r\n            configurable: false,\r\n            value: this\r\n        })\r\n        if (Array.isArray(value)) {\r\n            value.__proto__ = arrayMethods\r\n            this.observerArray(value)\r\n        } else {\r\n            this.walk(value) // 对对象的属性进行添加get/set\r\n        }\r\n    }\r\n\r\n    // 监控数组中的每一项实现响应式变化\r\n    observerArray(arr) { // arr: [{},{}]\r\n        arr.forEach(item => {\r\n            observer(item)\r\n        })\r\n    }\r\n\r\n    // 检测每一步的数据变化\r\n    walk(data) {\r\n        let keys = Object.keys(data) //keys = [name, age, attr]\r\n        keys.forEach(key => {\r\n            definedReactive(data, key, data[key])\r\n        })\r\n    }\r\n}\r\n\r\nfunction definedReactive(data, key, value) {\r\n    observer(value)\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if (newValue === value) return\r\n            // 这里再次使用递归考虑到属性的赋值可能是一个对象。\r\n            observer(newValue)\r\n            value = newValue\r\n        }\r\n    })\r\n}\r\n\r\n/** 递归实现 给对象的属性添加`get/set` */\r\nexport function observer(data) {\r\n    if (typeof data === 'object' && data !== null) {\r\n        return new Observer(data)\r\n    }\r\n}","// 初始化 props data computed watch 等属性\r\nimport {\r\n    observer\r\n} from './observer/index'\r\n\r\nexport function initState(vm) {\r\n    let opts = vm.$options\r\n    if (opts.props) {\r\n        initPros(vm)\r\n    }\r\n    if (opts.methods) {\r\n        initMethods(vm)\r\n    }\r\n    if (opts.data) {\r\n        initData(vm)\r\n    }\r\n    if (opts.computed) {\r\n        initComputed(vm)\r\n    }\r\n    if (opts.watch) {\r\n        initWatch(vm)\r\n    }\r\n}\r\n\r\nfunction initPros() {}\r\n\r\nfunction initMethods() {}\r\n\r\n/** vm._data 是为了保证可以访问到data(data假如是函数)属性的值 */\r\nfunction initData(vm) {\r\n    let data = vm.$options.data\r\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data\r\n    //响应式原理 数据劫持：劫持data对象的数据，使用 Object.definedProperty() 添加 get/set 方法\r\n\r\n    // 改变访问的方式 vm._data. === vm.  做一层代理\r\n    for (const key in data) {\r\n        proxy(vm, key)\r\n    }\r\n\r\n    observer(data)\r\n}\r\n\r\nfunction proxy(vm, key) {\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return vm['_data'][key]\r\n        },\r\n        set(newVal) {\r\n            return vm['_data'][key] = newVal\r\n        }\r\n    })\r\n}\r\n\r\n\r\nfunction initComputed() {}\r\n\r\nfunction initWatch() {}","import {initState} from './state'\r\n\r\nexport function initMixin(myVue) {\r\n    // 初始化流程\r\n    myVue.prototype._init = function (options) {\r\n        // 数据劫持，其他地方也需要使用\r\n        const vm = this\r\n        this.$options = options\r\n\r\n        // 初始化数据\r\n        initState(vm)\r\n    }\r\n\r\n\r\n}","import {initMixin} from './init'\r\nfunction myVue(options = {}){\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(myVue)\r\nexport default myVue"],"names":["oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","res","apply","instead","ob","__ob__","observerArray","Observer","value","defineProperty","enumerable","configurable","isArray","__proto__","walk","arr","item","observer","data","keys","key","definedReactive","get","set","newValue","initState","vm","opts","$options","props","initData","computed","watch","_data","call","proxy","newVal","initMixin","myVue","_init","options"],"mappings":"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"}